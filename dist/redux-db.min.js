var __assign=this&&this.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("utils",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toArray=function(t){return t?Array.isArray(t)?t:"object"==typeof t?Object.keys(t).map(function(e){return t[e]}):[]:[]},e.ensureArray=function(t){return t?Array.isArray(t)?t:[t]:[]},e.toObject=function(t,e){return t.reduce(function(t,r){return t[e(r)]=r,t},{})},e.isObject=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};var r=function(t){return e.isObject(t)&&"[object Object]"===Object.prototype.toString.call(t)};e.isPlainObject=function(t){var e,n;return r(t)&&"function"!=typeof(e=t.constructor)&&r(n=e.prototype)&&n.hasOwnProperty("isPrototypeOf")}}),define("schema",["require","exports","utils"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="PK",i="FK",o=function(){function t(t,e){var r=this;this.relations=[],this.name=t,this.fields=Object.keys(e).map(function(t){return new s(r,t,e[t])}),this._primaryKeyFields=this.fields.filter(function(t){return t.constraint===n}).map(function(t){return t.name}),this._foreignKeyFields=this.fields.filter(function(t){return t.constraint===i}).map(function(t){return t.name}),this._stampFields=this.fields.filter(function(t){return"MODIFIED"===t.type}).map(function(t){return t.name})}return t.prototype.connect=function(t){var e=this;t.forEach(function(t){e.relations=e.relations.concat(t.fields.filter(function(t){return t.references===e.name}))})},t.prototype.normalize=function(t,e){var n=this;if(void 0===e&&(e={}),"object"!=typeof t&&!Array.isArray(t))throw new Error("Failed to normalize data. Given argument is not a plain object nor an array.");if(e[this.name])throw new Error("Failed to normalize data. Circular reference detected.");return e[this.name]={ids:[],byId:{}},e[this.name].ids=r.ensureArray(t).map(function(r){var i=n.getPrimaryKey(r);e[n.name].byId[i]=r;return n.relations.forEach(function(r){if(r.relationName&&t[r.relationName]){var o=n.inferRelations(t[r.relationName],r,i);r.table.normalize(o,e),delete t[r.relationName]}}),i}),e},t.prototype.inferRelations=function(t,e,n){if(!e.relationName)return t;var i=e.table.fields.filter(function(t){return"FK"===t.constraint&&t!==e});return r.ensureArray(t).map(function(t){return"number"!=typeof t&&"string"!=typeof t||(1===i.length?((r={})[i[0].name]=t,t=r):t={id:t}),__assign({},t,(o={},o[e.name]=n,o));var r,o})},t.prototype.getPrimaryKey=function(t){var e=this._primaryKeyFields.length?this._primaryKeyFields:this._foreignKeyFields,r=null;if(1===e.length?r=t[e[0]]:e.length>1&&(r=e.reduce(function(e,r){var n=t[r];return e&&n?e+"_"+n:n},null)),null!==r&&void 0!==r&&"string"!=typeof r&&(r=r.toString()),!r||0===r.length)throw new Error('Failed to get primary key for record of type "'+this.name+'".');return r},t.prototype.isModified=function(t,e){var r=this;return 1===this._stampFields.length?t[this._stampFields[0]]!==e[this._stampFields[0]]:!(this._stampFields.length>1)||this._stampFields.reduce(function(n,i){return n+(t[r._stampFields[0]]!==e[r._stampFields[0]]?1:0)},0)!==this._stampFields.length},t}();e.TableSchema=o;var s=function(){function t(t,e,r){this.table=t,this.name=e,this.propName=r.name||e,this.type=r.type||"ATTR",this.constraint=r.constraint||"NONE",this.references=r.references,this.relationName=r.relationName}return t}();e.FieldSchema=s}),define("models",["require","exports","utils"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){void 0===t&&(t={});var n=this;this.state=t,this.tables=r.toObject(e.tables.map(function(e){return new i(n,t[e.name],e)}),function(t){return t.schema.name})}return t.prototype.upsert=function(t,e){var r=this;Object.keys(t).forEach(function(n){e&&n===e.schema.name||r.tables[n].upsertNormalized(t[n])})},t.prototype.commit=function(){var t=this;return Object.keys(this.tables).forEach(function(e){var r=t.state[e],n=t.tables[e].state;r!==n&&(t.state=__assign({},t.state,(i={},i[e]=n,i)));var i}),this.state},t}();e.Session=n;var i=function(){function t(t,e,r){void 0===e&&(e={ids:[],byId:{}}),this.session=t,this.state=e,this.schema=r}return t.prototype.all=function(){var t=this;return this.state.ids.map(function(e){return u.default.newRecord(e,t)})},t.prototype.filter=function(t){return this.all().filter(t)},t.prototype.get=function(t){if(t=t.toString(),!this.exists(t))throw new Error('No "'+this.schema.name+'" record with id: '+t+" exists.");return u.default.newRecord(t,this)},t.prototype.getOrDefault=function(t){return this.exists(t)?this.get(t):null},t.prototype.exists=function(t){return void 0!==this.state.byId[t]},t.prototype.insert=function(t){return this.insertMany(t)[0]},t.prototype.insertMany=function(t){return this._normalizedAction(t,this.insertNormalized)},t.prototype.update=function(t){return this.updateMany(t)[0]},t.prototype.updateMany=function(t){return this._normalizedAction(t,this.updateNormalized)},t.prototype.upsert=function(t){return this._normalizedAction(t,this.upsertNormalized)[0]},t.prototype.delete=function(t){var e=__assign({},this.state.byId),r=this.state.ids.slice();delete e[t];var n=r.indexOf(t);n>=0&&r.splice(n,1),this.state=__assign({},this.state,{byId:e,ids:r})},t.prototype.insertNormalized=function(t){var e=this;return this.state={ids:this.state.ids.concat(t.ids),byId:__assign({},this.state.byId,t.byId)},t.ids.map(function(t){return u.default.newRecord(t,e)})},t.prototype.updateNormalized=function(t){var e=this,r=__assign({},this.state),n=!1,i=Object.keys(t.byId).map(function(i){if(!e.state.byId[i])throw new Error('Failed to apply update. No "'+e.schema.name+'" record with id: '+i+" exists.");var o=t.byId[i],s=r.byId[i];return e.schema.isModified(s,o)&&(r.byId[i]=__assign({},s,o),n=!0),u.default.newRecord(i,e)});return n&&(this.state=r),i},t.prototype.upsertNormalized=function(t){var e=this,r={ids:[],byId:{}},n={ids:[],byId:{}};return t.ids.forEach(function(i){e.exists(i)?(r.ids.push(i),r.byId[i]=t.byId[i]):(n.ids.push(i),n.byId[i]=t.byId[i])}),(r.ids.length?this.updateNormalized(r):[]).concat(n.ids.length?this.insertNormalized(n):[])},t.prototype._normalizedAction=function(t,e){var r=this.schema.normalize(t),n=r[this.schema.name],i=n?e.call(this,n):[];return this.session.upsert(r,this),i},t}();e.TableModel=i;var o=function(){function t(t,e){this.id=t,this.table=e}return Object.defineProperty(t.prototype,"value",{get:function(){return this.table.state.byId[this.id]},enumerable:!0,configurable:!0}),t.prototype.delete=function(){this.table.delete(this.id)},t.prototype.update=function(t){return this.table.update(t),this},t}();e.RecordModel=o;var s=function(){function t(t,e){this.name=t.name,this.schema=t,this.record=e}return Object.defineProperty(t.prototype,"value",{get:function(){return this.record.value[this.name]},enumerable:!0,configurable:!0}),t}();e.RecordField=s;var a=function(){function t(t,e,r){this.table=t,this.schema=e,this.owner=r}return t.prototype.all=function(){var t=this;return this.table.filter(function(e){var r=e.value[t.schema.name];return r&&r.toString()===t.owner.id})},Object.defineProperty(t.prototype,"value",{get:function(){return this.map(function(t){return t.value})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.all().length},enumerable:!0,configurable:!0}),t.prototype.map=function(t){return this.all().map(t)},t.prototype.add=function(t){this.table.insert(this._normalize(t))},t.prototype.remove=function(t){var e=this;this._normalize(t).forEach(function(t){var r=e.table.schema.getPrimaryKey(t);e.table.delete(r)})},t.prototype.update=function(t){this.table.update(this._normalize(t))},t.prototype.delete=function(){var t=this;this.all().forEach(function(e){return t.table.delete(e.id)})},t.prototype._normalize=function(t){return this.table.schema.inferRelations(t,this.schema,this.owner.id)},t}();e.RecordSet=a;var u=function(){function t(){this._recordClass={}}return t.prototype.newRecord=function(t,e){return new(this._recordClass[e.schema.name]||(this._recordClass[e.schema.name]=this._createRecordModelClass(e.schema)))(t,e)},t.prototype.newRecordField=function(t,e){if("FK"===t.constraint&&t.table===e.table.schema&&t.references){if(!(r=e.table.session.tables[t.references]))throw new Error("The foreign key "+t.name+" references an unregistered table: "+t.table.name);return r.getOrDefault(e.value[t.name])}if("FK"===t.constraint&&t.table!==e.table.schema&&t.relationName){var r=e.table.session.tables[t.table.name];return new a(r,t,e)}return new s(t,e)},t.prototype._createRecordModelClass=function(e){var r=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n._fields={},n}return __extends(e,t),e}(o);return e.fields.concat(e.relations).forEach(function(e){if("FK"==e.constraint){var n=e.relationName||e.propName;Object.defineProperty(r.prototype,n,{get:function(){return this._fields[n]||(this._fields[n]=t.default.newRecordField(e,this))}})}}),r},t}();u.default=new u}),define("index",["require","exports","schema","models"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Record=n.RecordModel,e.RecordSet=n.RecordSet,e.Table=n.TableModel;var i={};e.createDatabase=function(t,e){return new o(t,e||i)};var o=function(){function t(t,e){var n=this;this.options=e,this.tables=Object.keys(t).map(function(e){return new r.TableSchema(e,t[e])}),this.tables.forEach(function(t){return t.connect(n.tables)})}return t.prototype.combineReducers=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r,n){void 0===r&&(r={});var i=t.createSession(r);return e.forEach(function(t){t(i.tables,n)}),i.commit()}},t.prototype.createSession=function(t){return new n.Session(t,this)},t}();e.Database=o});